import{a as e,eV as t,dq as a,cY as s,dH as r,dp as o,l as n,dz as i,dB as d,dC as c,dA as u,r as h,_ as l,n as m,b as g,t as p,e7 as b,x as v}from"./card-dfbafb45.js";import{s as _,h as y,c as w,d as C}from"./media-f31deba8.js";import{g as f}from"./get-technology-for-video-rtc-778a0c05.js";import{m as V}from"./audio-cf3a75aa.js";let x=class extends e{constructor(){super(...arguments),this.controls=!1,this._message=null,this._webrtcTask=new t(this,this._getWebRTCCardElement,(()=>[1]))}async play(){return this._getVideo()?.play()}async pause(){this._getVideo()?.pause()}async mute(){const e=this._getVideo();e&&(e.muted=!0)}async unmute(){const e=this._getVideo();e&&(e.muted=!1)}isMuted(){return this._getVideo()?.muted??!0}async seek(e){const t=this._getVideo();t&&(t.currentTime=e)}async setControls(e){const t=this._getVideo();t&&_(t,e??this.controls)}isPaused(){return this._getVideo()?.paused??!0}async getScreenshotURL(){const e=this._getVideo();return e?a(e):null}getFullscreenElement(){return this._getVideo()}connectedCallback(){super.connectedCallback(),this.requestUpdate()}disconnectedCallback(){this._message=null,super.disconnectedCallback()}willUpdate(e){["cameraConfig","cameraEndpoints"].some((t=>e.has(t)))&&(this._message=null)}_getVideoRTC(){return this.renderRoot?.querySelector("#webrtc")??null}_getVideo(){return this._getVideoRTC()?.video??null}async _getWebRTCCardElement(){return await customElements.whenDefined("webrtc-camera"),customElements.get("webrtc-camera")}_createWebRTC(){const e=this._webrtcTask.value;if(e&&this.hass&&this.cameraConfig){const t=new e,a={intersection:0,muted:!0,...this.cameraConfig.webrtc_card};return a.url||a.entity||!this.cameraEndpoints?.webrtcCard||(a.entity=this.cameraEndpoints.webrtcCard.endpoint),t.setConfig(a),t.hass=this.hass,t}return null}render(){if(this._message)return s(this._message);return r(this._webrtcTask,(()=>{let e;try{e=this._createWebRTC()}catch(e){return this._message={type:"error",message:e instanceof b?e.message:n("error.webrtc_card_reported_error")+": "+e.message,context:e.context},void C(this)}return e&&(e.id="webrtc"),v`${e}`}),{inProgressFunc:()=>o({message:n("error.webrtc_card_waiting"),cardWideConfig:this.cardWideConfig})})}updated(){this.updateComplete.then((()=>{const e=this._getVideoRTC(),t=this._getVideo();t&&(_(t,this.controls),t.onloadeddata=()=>{this.controls&&y(t,w),i(this,t,{player:this,capabilities:{supportsPause:!0,hasAudio:V(t)},...e&&{technology:f(e)}})},t.onplay=()=>d(this),t.onpause=()=>c(this),t.onvolumechange=()=>u(this))}))}static get styles(){return h(":host {\n  width: 100%;\n  height: 100%;\n  display: block;\n}\n\n/* Don't drop shadow or have radius for nested webrtc card */\n#webrtc ha-card {\n  border-radius: 0px;\n  margin: 0px;\n  box-shadow: none;\n}\n\nha-card,\ndiv.fix-safari,\n#video {\n  background: unset;\n  background-color: unset;\n}\n\n#webrtc #video {\n  object-fit: var(--advanced-camera-card-media-layout-fit, contain);\n  object-position: var(--advanced-camera-card-media-layout-position-x, 50%) var(--advanced-camera-card-media-layout-position-y, 50%);\n  object-view-box: inset(var(--advanced-camera-card-media-layout-view-box-top, 0%) var(--advanced-camera-card-media-layout-view-box-right, 0%) var(--advanced-camera-card-media-layout-view-box-bottom, 0%) var(--advanced-camera-card-media-layout-view-box-left, 0%));\n}")}};l([m({attribute:!1})],x.prototype,"cameraConfig",void 0),l([m({attribute:!1})],x.prototype,"cameraEndpoints",void 0),l([m({attribute:!1})],x.prototype,"cardWideConfig",void 0),l([m({attribute:!0,type:Boolean})],x.prototype,"controls",void 0),l([g()],x.prototype,"_message",void 0),x=l([p("advanced-camera-card-live-webrtc-card")],x);export{x as AdvancedCameraCardLiveWebRTCCard};
